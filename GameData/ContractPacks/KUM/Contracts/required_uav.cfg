CONTRACT_TYPE
{
	name = kumRequiredUav

	title = "Unidentified aircraft over the KSC"
	genericTitle = "Unidentified aircraft over the KSC"

	group = munistorumDataStore
	agent = komUniMun

	description = "An unidentified aircraft has recently violated KSC airspace, for the safety of our operations you must identify and destroy the violating aircraft." + "\n\nMission Latitude: " + @titleLat + "\nMission Longitude: " + @titleLon
	genericDescription = "An unidentified aircraft has recently violated KSC airspace, for the safety of our operations you must identify and destroy the violating aircraft."

	topic = Weapons
	subject = Experiment

	synopsis = "synopsis"
	notes = "notes"

	completedMessage = "Mission accomplished! This was a rather suspicios violation, we will look over the flight log and then debrief you on the situation."

	minExpiry = 3.0
	maxExpiry = 7.0

	cancellable = true
	declinable = false

	targetBody = HomeWorld()

	maxCompletions = 1
	maxSimultaneous = 1

	// Data node for the rewards
	DATA
	{
		type = double

		science = 0.0 // Zero for non-test missions
		reputation = 4 * Random(0.8, 1.2)
		funds = 4000 * Random(0.8, 1.2)
	}

	// Target Names
	DATA
	{
		type = string

		targetUav = "Unidentified Aircraft"
	}

	// Vehicle Positions
	DATA
	{
		type = double

		squadLat = Random(-0.2, 0.2)
		squadLon = Random(-73.575, -72.575)
		squadAlt = Random(5000.0, 10000.0)
		squadHdg = Random(0.0, 360.0)
	}

	// Title Coordinates
	DATA
	{
		type = double

		titleLat = Round(@squadLat)
		titleLon = Round(@squadLon)
	}

	// Requirement node for contract prerequisites
	REQUIREMENT
	{
		name = PartUnlocked
		type = PartUnlocked
		part = missileController
	}

	// Value definitions
	rewardScience = @/science
	rewardReputation = @/reputation
	rewardFunds = @/funds

	failureReputation = @/reputation / 4
	failureFunds = @/funds / 8
	advanceFunds = @/funds / 4

	// Behaviour such as vessel location, name etc

	// Drone
	BEHAVIOUR
	{
		name = SpawnDrone
		type = SpawnVessel
		deferVesselCreation = true

		VESSEL
		{
			name = @/targetUav
			craftURL = "ContractPacks/KUM/Assets/Ships/enemy_uav_01.craft"
			flagURL = Squad/Flags/satellite
			vesselType = Unknown
			owned = false
			targetBody = HomeWorld()

			lat = @/squadLat
			lon = @/squadLon
			alt = @/squadAlt

			heading = @/squadHdg
		}
	}

	// Destroy all mission vessels for safety
	BEHAVIOUR
	{
		name = ContingencyCleanup
		type = DestroyVessel

		onState = PARAMETER_COMPLETED
		parameter = DestroyCraft

		vessel = @/targetUav
	}

	// KSC waypoint
	BEHAVIOUR
	{
		name = ReturnWaypoint
		type = WaypointGenerator

		WAYPOINT
		{
			name = kscWaypoint

			hidden = true

			clustered = false
			underwater = false

			targetBody = HomeWorld()

			latitude = -0.0969
			longitude = -74.6004
			altitude = 0.0
		}
	}

	// Parameters for completing the contract
	PARAMETER
	{
		name = IdentificationSequence
		type = All

		title = "Identify the aircraft"
		completedMessage = "The aircraft was identified, it is hostile! Shoot it down!"

		rewardReputation = 4 * Random(0.8, 1.2)

		disableOnStateChange = true
		optional = true

		PARAMETER
		{
			name = RendezvousCraft
			type = Rendezvous

			title = "Approach the vehicle within 500 meters of distance"
			notes = "Rendezvous should allow us to identify the aircraft with a special device."

			vessel = @/targetUav

			disableOnStateChange = true

			distance = 500.0
		}

		PARAMETER
		{
			name = IdentifyCraft
			type = Duration

			preWaitText = "Rendezvous for identification"
			waitingText = "Identifying aircraft..."
			completionText = "Identification"

			duration = 5s

			startCriteria = PARAMETER_COMPLETION
			parameter = RendezvousCraft
		}
	}

	// Combat parameters
	PARAMETER
	{
		name = CombatSequence
		type = Sequence

		title = "Shoot down the aircraft"
		notes = "This aircraft is violating our airspace without communication and can be destroyed."

		hiddenParameter = DestroyCraft

		PARAMETER
		{
			name = DestroyCraft
			type = TargetDestroyed

			title = "Destroy the aircraft"

			vessel = @/targetUav
		}

		// Parameter for recovering the vessel after the mission
		PARAMETER
		{
			name = ToBase
			type = All

			title = "Return to the KSC and recover your vessel"

			disableOnStateChange = true
			completeInSequence = true

			PARAMETER
			{
				name = LandBase
				type = ReturnHome

				title = "Stop your vessel on the surface"
			}

			PARAMETER
			{
				name = isInKsc
				type = VisitWaypoint

				title = "At the KSC"

				index = 0
				distance = 500.0

				hideOnCompletion = true
			}

			PARAMETER
			{
				name = RecoverBase
				type = RecoverVessel

				title = "Recover the vessel"
				completedMessage = "The vessel was successfully recovered!"
			}
		}
	}
}
