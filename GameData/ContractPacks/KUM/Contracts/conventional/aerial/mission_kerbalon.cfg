CONTRACT_TYPE
{
	name = kumKerbalonPixy

	title = "Hostile near Kerbalon Dam"
	genericTitle = "Hostile near Kerbalon Dam"

	group = munistorumAerial
	agent = komUniMun

	description = "A prototype fighter was recently stolen, we've confirmed a vessel with its RCS signature was detected near Kerbalon Dam." + "\nThe aircraft has special weapons, remain aware of its burst missiles and the laser module." + "\n\nWe cannot tolerate robbery of this aircraft, destroy it." + "\n\nMission Latitude: 39" +"\nMission Longitude: -141"
	genericDescription = "A prototype fighter was recently stolen, we've confirmed a vessel with its RCS signature was detected near Kerbalon Dam." + "\nThe aircraft has special weapons, remain aware of its burst missiles and the laser module." + "\n\nWe cannot tolerate robbery of this aircraft, destroy it."

	topic = Weapons
	subject = Experiment

	synopsis = "Destroy the stolen aircraft near Kerbalon Dam."

	completedMessage = "Mission accomplished! completedMessage"

	minExpiry = 0.0
	maxExpiry = 0.0

	cancellable = true
	declinable = true

	targetBody = HomeWorld()

	maxCompletions = 0
	maxSimultaneous = 1

	// Data node for the rewards
	DATA
	{
		type = double

		science = 0.0 // Zero for non-test missions
		reputation = 9 * Random(0.8, 1.2)
		funds = 10000 * Random(0.8, 1.2)
	}

	// Name Safety
	DATA
	{
		type = int

		nameAppend = Random(0, 65535)

		hidden = true
	}

	// Target Names
	DATA
	{
		type = string
		title = "Target vessels"

		targetAircraft = "SP Aircraft 1" + " ID: " + @/nameAppend

		targetBoat1 = "Boat 1" + " ID: " + @/nameAppend
		targetBoat2 = "Boat 2" + " ID: " + @/nameAppend
		targetBoat3 = "Boat 3" + " ID: " + @/nameAppend
		targetBoat4 = "Boat 4" + " ID: " + @/nameAppend
	}

	// Vehicle Lists
	DATA
	{
		type = List<string>

		shipList = @/munistorumDataStore:boatList
	}

	// Vehicle Positions
	DATA
	{
		type = double

		squadLat1 = 32.36
		squadLon1 = -138.12
		squadHdg1 = Random(80.0, 100.0)

		squadLat2 = 35.11
		squadLon2 = -136.82
		squadHdg2 = Random(215.0, 230.0)

		squadOffset = 0.4
	}

	// Requirement node for contract prerequisites
	REQUIREMENT
	{
		name = CompleteContract
		type = CompleteContract
		contractType = kumRequiredAerial
	}

	// Value definitions
	rewardScience = @/science
	rewardReputation = @/reputation
	rewardFunds = @/funds

	failureReputation = @/reputation / 4
	failureFunds = @/funds / 8
	advanceFunds = @/funds / 4
	
	// Behaviour such as vessel location, name etc

	// Squad 1
	BEHAVIOUR
	{
		name = SpawnAircraft
		type = SpawnVessel
		deferVesselCreation = true

		VESSEL
		{
			name = @/targetAircraft
			craftURL = "ContractPacks/KUM/Assets/Ships/enemy_fighter_04.craft"
			flagURL = Squad/Flags/satellite
			vesselType = Unknown
			owned = false
			targetBody = HomeWorld()

			lat = Random(45.0, 46.0)
			lon = Random(-141.5, -141.5)
			alt = Random(5000.0, 10000.0)

			heading = Random(150.0, 170.0)
		}
	}

	// Squad 2
	BEHAVIOUR
	{
		name = SpawnBoat1
		type = SpawnVessel
		deferVesselCreation = true

		VESSEL
		{
			name = @/targetBoat1
			craftURL = "ContractPacks/KUM/Assets/Ships/" + @/shipList.Random()
			flagURL = Squad/Flags/satellite
			vesselType = Unknown
			owned = false
			targetBody = HomeWorld()

			lat = @/squadLat1 + 0.005
			lon = @/squadLon1 + 0.005
			height = 5

			heading = @/squadHdg1
		}
	}

	BEHAVIOUR
	{
		name = SpawnBoat2
		type = SpawnVessel
		deferVesselCreation = true

		VESSEL
		{
			name = @/targetBoat2
			craftURL = "ContractPacks/KUM/Assets/Ships/" + @/shipList.Random()
			flagURL = Squad/Flags/satellite
			vesselType = Unknown
			owned = false
			targetBody = HomeWorld()

			lat = @/squadLat1 - 0.005
			lon = @/squadLon1 - 0.005
			height = 5

			heading = @/squadHdg1
		}
	}

	// Squad 3
	BEHAVIOUR
	{
		name = SpawnBoat3
		type = SpawnVessel
		deferVesselCreation = true

		VESSEL
		{
			name = @/targetBoat3
			craftURL = "ContractPacks/KUM/Assets/Ships/" + @/shipList.Random()
			flagURL = Squad/Flags/satellite
			vesselType = Unknown
			owned = false
			targetBody = HomeWorld()

			lat = @/squadLat2 + 0.005
			lon = @/squadLon2 + 0.005
			height = 5

			heading = @/squadHdg2
		}
	}

	BEHAVIOUR
	{
		name = SpawnBoat4
		type = SpawnVessel
		deferVesselCreation = true

		VESSEL
		{
			name = @/targetBoat4
			craftURL = "ContractPacks/KUM/Assets/Ships/" + @/shipList.Random()
			flagURL = Squad/Flags/satellite
			vesselType = Unknown
			owned = false
			targetBody = HomeWorld()

			lat = @/squadLat2 - 0.005
			lon = @/squadLon2 - 0.005
			height = 5

			heading = @/squadHdg2
		}
	}

	// Destroy all mission vessels for safety
	BEHAVIOUR
	{
		name = ContingencyCleanup1
		type = DestroyVessel

		onState = CONTRACT_FAILED

		vessel = @/targetAircraft
		vessel = @/targetBoat1
		vessel = @/targetBoat2
		vessel = @/targetBoat3
		vessel = @/targetBoat4
	}

	BEHAVIOUR
	{
		name = ContingencyCleanup2
		type = DestroyVessel

		onState = PARAMETER_COMPLETED
		parameter = DestroyOrExit1

		vessel = @/targetBoat1
		vessel = @/targetBoat2
	}

	BEHAVIOUR
	{
		name = ContingencyCleanup3
		type = DestroyVessel

		onState = PARAMETER_COMPLETED
		parameter = DestroyOrExit2

		vessel = @/targetBoat3
		vessel = @/targetBoat4
	}

	// River waypoints
	BEHAVIOUR
	{
		name = ReturnWaypoint
		type = WaypointGenerator

		WAYPOINT
		{
			name = River Entrance

			icon = balloon

			clustered = false
			underwater = false

			targetBody = HomeWorld()

			latitude = 30.125
			longitude = -135.70
			altitude = 0.0
		}

		WAYPOINT
		{
			name = Progress Marker 1

			icon = balloon

			clustered = false
			underwater = false

			targetBody = HomeWorld()

			latitude = 31.39
			longitude = -137.15
			altitude = 0.0
		}

		WAYPOINT
		{
			name = Progress Marker 2

			icon = balloon

			clustered = false
			underwater = false

			targetBody = HomeWorld()

			latitude = 33.9
			longitude = -137.9
			altitude = 0.0
		}

		WAYPOINT
		{
			name = Progress Marker 3

			icon = balloon

			clustered = false
			underwater = false

			targetBody = HomeWorld()

			latitude = 35.46
			longitude = -136.51
			altitude = 0.0
		}

		WAYPOINT
		{
			name = Progress Marker 4

			icon = balloon

			clustered = false
			underwater = false

			targetBody = HomeWorld()

			latitude = 37.06
			longitude = -138.18
			altitude = 0.0
		}

		WAYPOINT
		{
			name = River Exit

			icon = balloon

			clustered = false
			underwater = false

			targetBody = HomeWorld()

			latitude = 38.56
			longitude = -140.42
			altitude = 0.0
		}
	}

	// Optional extra reward parameters
	PARAMETER
	{
		name = DestroyOrExit1
		type = AtMost

		title = "Destroy the boats in the river's pocket (optional)"

		optional = true

		count = 1

		PARAMETER
		{
			name = DestroyBoat1
			type = TargetDestroyed

			title = "Eliminate the enemy"

			optional = true

			vessel = @/targetBoat1
			vessel = @/targetBoat2

			rewardReputation = (@/reputation / 4) * 2
			rewardFunds = (@/funds / 4) * 2
		}

		PARAMETER
		{
			name = ExitChecker1
			type = VisitWaypoint

			index = 5
			distance = 2000.0

			hidden = true

			disableOnStateChange = true
			hideOnCompletion = true
		}
	}

	PARAMETER
	{
		name = DestroyOrExit2
		type = All

		title = "Destroy the boats blocking the river (optional)"

		optional = true

		count = 1

		PARAMETER
		{
			name = DestroyBoat2
			type = TargetDestroyed

			title = "Eliminate the enemy"

			optional = true

			vessel = @/targetBoat3
			vessel = @/targetBoat4

			rewardReputation = (@/reputation / 4) * 2
			rewardFunds = (@/funds / 4) * 2
		}

		PARAMETER
		{
			name = ExitChecker2
			type = VisitWaypoint

			index = 5
			distance = 2000.0

			hidden = true

			disableOnStateChange = true
			hideOnCompletion = true
		}
	}

	// Parameters for completing the contract
	PARAMETER
	{
		name = ApproachSequence
		type = Sequence

		title = "Approach through the river"

		failWhenCompleteOutOfOrder = true

		PARAMETER
		{
			name = Entrance
			type = VisitWaypoint

			index = 0
			distance = 2000.0

			disableOnStateChange = true
			hideOnCompletion = true
		}

		PARAMETER
		{
			name = Progress1
			type = VisitWaypoint

			index = 1
			distance = 2000.0

			disableOnStateChange = true
			hideOnCompletion = true
		}

		PARAMETER
		{
			name = Progress2
			type = VisitWaypoint

			index = 2
			distance = 2000.0

			disableOnStateChange = true
			hideOnCompletion = true
		}

		PARAMETER
		{
			name = Progress3
			type = VisitWaypoint

			index = 3
			distance = 2000.0

			disableOnStateChange = true
			hideOnCompletion = true
		}

		PARAMETER
		{
			name = Progress4
			type = VisitWaypoint

			index = 4
			distance = 2000.0

			disableOnStateChange = true
			hideOnCompletion = true
		}

		PARAMETER
		{
			name = Exit
			type = VisitWaypoint

			index = 5
			distance = 2000.0

			disableOnStateChange = true
			hideOnCompletion = true
		}

		PARAMETER
		{
			name = RiverAltitudeCheck
			type = AtMost

			title = "Without exceeding the altitude limit of 250m"

			count = 1
			completeInSequence = true

			PARAMETER
			{
				name = EntranceChecker
				type = VisitWaypoint

				index = 0
				distance = 2000.0

				hidden = true

				disableOnStateChange = true
				hideOnCompletion = true
			}

			PARAMETER
			{
				name = ReachState
				type = ReachState

				hidden = true

				minAltitude = 250
			}
		}

		// Combat parameters
		PARAMETER
		{
			name = CombatSequence
			type = Sequence

			title = "Eliminate the enemy"

			hiddenParameter = DestroyCraft

			PARAMETER
			{
				name = DestroyCraft
				type = TargetDestroyed

				title = "Eliminate the enemy"

				vessel = @/targetAircraft
			}

			// Parameter for recovering the vessel after the mission
			PARAMETER
			{
				name = ToBase
				type = All

				title = "Land the vessel and recover it safely on Kerbin"

				disableOnStateChange = true
				completeInSequence = true

				PARAMETER
				{
					name = LandBase
					type = ReturnHome

					title = "Stop the vessel on the surface"
				}

				PARAMETER
				{
					name = RecoverBase
					type = RecoverVessel

					title = "Recover the vessel"
					completedMessage = "The vessel was successfully recovered!"
				}
			}
		}
	}
}
