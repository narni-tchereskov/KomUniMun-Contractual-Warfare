CONTRACT_TYPE
{
	name = kumKerbalonPixy

	title = "Hostile near the Kerbalon Dam"
	genericTitle = "Hostile near the Kerbalon Dam"

	group = munistorumAerial
	agent = komUniMun

	description = "A prototype fighter was recently stolen, we've confirmed a vessel with its RCS signature was detected near the Kerbalon Dam." + "\nThe aircraft has special weapons, remain aware of its burst missiles and the laser module." + "\n\nWe cannot tolerate robbery of this aircraft, destroy it." + "\n\nMission Latitude: " + @titleLat +"\nMission Longitude: " + @titleLon
	genericDescription = "A prototype fighter was recently stolen, we've confirmed a vessel with its RCS signature was detected near the Kerbalon Dam." + "\nThe aircraft has special weapons, remain aware of its burst missiles and the laser module." + "\n\nWe cannot tolerate robbery of this aircraft, destroy it."

	topic = Weapons
	subject = Experiment

	synopsis = "Destroy the stolen aircraft near the Kerbalon Dam."

	completedMessage = "Mission accomplished! completedMessage"

	minExpiry = 0.0
	maxExpiry = 0.0

	cancellable = true
	declinable = true

	targetBody = HomeWorld()

	maxCompletions = 0
	maxSimultaneous = 1

	// Data node for the rewards
	DATA
	{
		type = double

		science = 0.0 // Zero for non-test missions
		reputation = 9 * Random(0.8, 1.2)
		funds = 10000 * Random(0.8, 1.2)
	}

	// Name Safety
	DATA
	{
		type = int

		nameAppend = Random(0, 65535)

		hidden = true
	}

	// Target Names
	DATA
	{
		type = string
		title = "Target vessels"

		targetAircraft = "SP Aircraft 1" + " ID: " + @/nameAppend
	}

	// Vehicle Positions
	DATA
	{
		type = double

		squadLat = Random(45.0, 46.0)
		squadLon = Random(-141.5, -141.5)
		squadAlt = Random(5000.0, 10000.0)
		squadHdg = Random(150.0, 170.0)

		squadOffset = 0.4
	}

	// Title Coordinates
	DATA
	{
		type = double

		titleLat = Round(@squadLat)
		titleLon = Round(@squadLon)
	}

	// Requirement node for contract prerequisites
	REQUIREMENT
	{
		name = CompleteContract
		type = CompleteContract
		contractType = kumRequiredAerial
	}

	// Value definitions
	rewardScience = @/science
	rewardReputation = @/reputation
	rewardFunds = @/funds

	failureReputation = @/reputation / 4
	failureFunds = @/funds / 8
	advanceFunds = @/funds / 4
	
	// Behaviour such as vessel location, name etc

	// Squad 1
	BEHAVIOUR
	{
		name = SpawnAircraft
		type = SpawnVessel
		deferVesselCreation = true

		VESSEL
		{
			name = @/targetAircraft
			craftURL = "ContractPacks/KUM/Assets/Ships/enemy_interceptor_01d.craft"
			flagURL = Squad/Flags/satellite
			vesselType = Unknown
			owned = false
			targetBody = HomeWorld()

			lat = @/squadLat
			lon = @/squadLon
			alt = @/squadAlt

			heading = @/squadHdg
		}
	}

	// Destroy all mission vessels for safety
	BEHAVIOUR
	{
		name = ContingencyCleanup
		type = DestroyVessel

		onState = PARAMETER_COMPLETED
		parameter = DestroyCraft

		vessel = @/targetAircraft
	}

	// River waypoints
	BEHAVIOUR
	{
		name = ReturnWaypoint
		type = WaypointGenerator

		WAYPOINT
		{
			name = RiverStartWaypoint

			icon = balloon

			clustered = false
			underwater = false

			targetBody = HomeWorld()

			latitude = 30.125
			longitude = -135.70
			altitude = 0.0
		}

		WAYPOINT
		{
			name = RiverEndWaypoint

			icon = balloon

			clustered = false
			underwater = false

			targetBody = HomeWorld()

			latitude = 38.56
			longitude = -140.42
			altitude = 0.0
		}

		WAYPOINT
		{
			name = AltitudeLimitWaypoint

			hidden = true

			clustered = false
			underwater = false

			targetBody = HomeWorld()

			latitude = 34.3425
			longitude = -138.06
			altitude = 500.0
		}
	}

	// Parameters for completing the contract
	PARAMETER
	{
		name = ApproachSequence
		type = Sequence

		title = "Approach through the river"

		failWhenCompleteOutOfOrder = true

		PARAMETER // Currently broken
		{
			name = Not
			type = Not

			title = "Without exceeding the altitude limit of 500m"

			completeInSequence = false

			PARAMETER
			{
				name = ReachState
				type = ReachState

				hidden = true

				targetBody = HomeWorld()

				minAltitude = 500

				completeInSequence = true
				disableOnStateChange = false
			}
		}

		PARAMETER
		{
			name = RiverEntrance
			type = All

			title = "Enter the Kerbalon River"

			hideChildren = true
			disableOnStateChange = false

			PARAMETER
			{
				name = Entrance
				type = VisitWaypoint

				index = 0
				distance = 2000.0

				completeInSequence = true
				hideOnCompletion = true
			}
		}

		PARAMETER
		{
			name = RiverExit
			type = All

			title = "Exit the Kerbalon River"

			hideChildren = true
			disableOnStateChange = true

			PARAMETER
			{
				name = Exit
				type = VisitWaypoint

				title = "End of River"

				index = 1
				distance = 2000.0

				completeInSequence = true
				hideOnCompletion = true
			}
		}
	}

	// Combat parameters
	PARAMETER
	{
		name = CombatSequence
		type = Sequence

		title = "Eliminate the enemy"

		hiddenParameter = DestroyCraft

		PARAMETER
		{
			name = DestroyCraft
			type = TargetDestroyed

			title = "Eliminate the enemy"

			vessel = @/targetAircraft
		}

		// Parameter for recovering the vessel after the mission
		PARAMETER
		{
			name = ToBase
			type = All

			title = "Land the vessel and recover it safely on Kerbin"

			disableOnStateChange = true
			completeInSequence = true

			PARAMETER
			{
				name = LandBase
				type = ReturnHome

				title = "Stop the vessel on the surface"
			}

			PARAMETER
			{
				name = RecoverBase
				type = RecoverVessel

				title = "Recover the vessel"
				completedMessage = "The vessel was successfully recovered!"
			}
		}
	}
}
