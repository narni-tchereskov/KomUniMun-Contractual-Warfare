CONTRACT_TYPE
{
	name = kumAssaultMarine

	title = "Interrupt the KSC Naval Assault"
	genericTitle = "Interrupt the KSC Naval Assault"

	group = munistorumNaval
	agent = komUniMun

	description = "A large number of patrol boats have been spotted east of the KSC by our latest recon flight which was fired at." + "\nThe vessels have light armaments but they still pose a threat to our facilities." + "\n\nDestroy them and retrieve our sea!" + "\n\nMission Latitude: " + @titleLat + "\nMission Longitude: " + @titleLon
	genericDescription = "A large number of patrol boats have been spotted east of the KSC by our latest recon flight which was fired at." + "\nThe vessels have light armaments but they still pose a threat to our facilities." + "\n\nDestroy them and retrieve our sea!"

	topic = Weapons
	subject = Experiment

	synopsis = "Destroy the enemy flotilla forming an assault on the KSC."

	completedMessage = "Mission accomplished! completedMessage"

	minExpiry = 0.0
	maxExpiry = 0.0

	cancellable = true
	declinable = true

	targetBody = HomeWorld()

	maxCompletions = 0
	maxSimultaneous = 1

	// Data node for the rewards
	DATA
	{
		type = double

		science = 0.0 // Zero for non-test missions
		reputation = 9 * Random(0.8, 1.2)
		funds = 16000 * Random(0.8, 1.2)
	}

	// Name Safety
	DATA
	{
		type = int

		nameAppend = Random(0, 65535)

		hidden = true
	}

	// Target Names
	DATA
	{
		type = string
		title = "Target vessels"

		targetBoat1 = "Boat 1" + " ID: " + @/nameAppend
		targetBoat2 = "Boat 2" + " ID: " + @/nameAppend
		targetBoat3 = "Boat 3" + " ID: " + @/nameAppend

		targetSAM1 = "SAM 1" + " ID: " + @/nameAppend
	}

	// Vehicle Lists
	DATA
	{
		type = List<string>

		shipList = @/munistorumDataStore:boatList
		samList = @/munistorumDataStore:boatSamList
	}

	// Vehicle Positions
	DATA
	{
		type = double

		squadLat = Random(-3.5, -2.1)
		squadLon = Random(-72.1, -70.6)
		squadHdg = Random(265.0, 285.0)

		samOffset = 0.2
	}

	// Title Coordinates
	DATA
	{
		type = double

		titleLat = Round(@squadLat)
		titleLon = Round(@squadLon)
	}

	// Requirement node for contract prerequisites
	REQUIREMENT
	{
		name = CompleteContract
		type = CompleteContract
		contractType = kumRequiredNaval
	}

	// Value definitions
	rewardScience = @/science
	rewardReputation = @/reputation
	rewardFunds = @/funds

	failureReputation = @/reputation / 4
	failureFunds = @/funds / 8
	advanceFunds = @/funds / 4
	
	// Behaviour such as vessel location, name etc

	// Regular Boats
	BEHAVIOUR
	{
		name = SpawnBoat
		type = SpawnVessel
		deferVesselCreation = true

		VESSEL
		{
			name = @/targetBoat1
			craftURL = "ContractPacks/KUM/Assets/Ships/" + @/shipList.Random()
			flagURL = Squad/Flags/satellite
			vesselType = Unknown
			owned = false
			targetBody = HomeWorld()

			lat = @/squadLat
			lon = @/squadLon
			height = 5

			heading = @/squadHdg
		}

		VESSEL
		{
			name = @/targetBoat2
			craftURL = "ContractPacks/KUM/Assets/Ships/" + @/shipList.Random()
			flagURL = Squad/Flags/satellite
			vesselType = Unknown
			owned = false
			targetBody = HomeWorld()

			lat = @/squadLat - 0.005
			lon = @/squadLon - 0.005
			height = 5

			heading = @/squadHdg
		}

		VESSEL
		{
			name = @/targetBoat3
			craftURL = "ContractPacks/KUM/Assets/Ships/" + @/shipList.Random()
			flagURL = Squad/Flags/satellite
			vesselType = Unknown
			owned = false
			targetBody = HomeWorld()

			lat = @/squadLat - 0.01
			lon = @/squadLon - 0.01
			height = 5

			heading = @/squadHdg
		}
	}

	// SAM Boats
	BEHAVIOUR
	{
		name = SpawnBoatSAM
		type = SpawnVessel
		deferVesselCreation = true

		VESSEL
		{
			name = @/targetSAM1
			craftURL = "ContractPacks/KUM/Assets/Ships/" + @/samList.Random()
			flagURL = Squad/Flags/satellite
			vesselType = Unknown
			owned = false
			targetBody = HomeWorld()

			lat = @/squadLat - @/samOffset
			lon = @/squadLon + @/samOffset
			height = 5

			heading = @/squadHdg
		}
	}

	// Destroy all mission vessels for safety
	BEHAVIOUR
	{
		name = ContingencyCleanup
		type = DestroyVessel

		onState = CONTRACT_FAILED

		vessel = @/targetBoat1
		vessel = @/targetBoat2
		vessel = @/targetBoat3

		vessel = @/targetSAM1
	}

	// Parameters for completing the contract

	// Combat parameters
	PARAMETER
	{
		name = CombatSequence
		type = Sequence

		title = "Eliminate the enemy"

		hiddenParameter = DestroyCraft

		PARAMETER
		{
			name = DestroyCraft
			type = TargetDestroyed

			title = "Eliminate the enemy"

			vessel = @/targetBoat1
			vessel = @/targetBoat2
			vessel = @/targetBoat3

			vessel = @/targetSAM1
		}

		// Parameter for recovering the vessel after the mission
		PARAMETER
		{
			name = ToBase
			type = All

			title = "Stop your vessel and recover it safely on Kerbin"

			disableOnStateChange = true
			completeInSequence = true

			PARAMETER
			{
				name = LandBase
				type = ReturnHome

				title = "Stop your vessel on the surface"
			}

			PARAMETER
			{
				name = RecoverBase
				type = RecoverVessel

				title = "Recover the vessel"
				completedMessage = "The vessel was successfully recovered!"
			}
		}
	}
}
