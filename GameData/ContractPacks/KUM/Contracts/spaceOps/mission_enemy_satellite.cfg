CONTRACT_TYPE
{
	name = kumEnemySatellite

	title = "Surveillance Satellite near " + @/orbitBody
	genericTitle = "Surveillance Satellite"

	group = munistorumSpaceOps
	agent = komUniMun

	description = "An unarmed surveillance satellite has recently been tracked near " + @/orbitBody + ", we have confirmed it carries a large dish, likely used for SIGINT. Approach the target then examine and/or destroy it."
	genericDescription = "You must examine and/or destroy the satellite."

	topic = Weapons
	subject = Experiment

	synopsis = "Examine the satellite and then destroy it."
	notes = "Bring space-to-space, air-to-space or surface-to-space ordnance on your interceptor for this mission, the satellite MAY be unarmed."

	completedMessage = "Mission accomplished! We will verify the origins of the satellite and then contact you."

	minExpiry = 3.0
	maxExpiry = 7.0

	cancellable = true
	declinable = true

	targetBody = @/orbitBody

	maxCompletions = 0
	maxSimultaneous = 2

	// Data node for the rewards
	DATA
	{
		type = double

		science = 0.0 // Zero for non-test missions
		reputation = 8 * Random(0.8, 1.2)
		funds = 16000 * Random(0.8, 1.2)
	}

	// Name Safety
	DATA
	{
		type = int

		nameAppend = Random(0, 65535)

		hidden = true
	}

	// Target Names
	DATA
	{
		type = string
		title = "Target vessels"

		targetVessel = "Hostile Satellite" + " ID: " + @/nameAppend
	}

	// Vehicle Lists
	DATA
	{
		type = List<string>

		satelliteList = @/munistorumDataStore:satelliteList
	}

	// Planet
	DATA
	{
		type = CelestialBody

		orbitBody = AllBodies().Where(b => b.IsHomeWorld() || (b.IsMoon() && b.Parent().IsHomeWorld())).SelectUnique()
		uniquenessCheck = GROUP_ACTIVE

		hidden = true
	}

	// Is recovery necessary?
	DATA
	{
		type = int

		needRecoverValue = Random(0,1)

		hidden = true
	}

	DATA
	{
		type = bool

		needRecoverBool = @/needRecoverValue == 1

		hidden = true
	}

	// Requirement node for contract prerequisites
	REQUIREMENT
	{
		name = CompleteContract
		type = CompleteContract
		contractType = kumEnemyKillsat
	}

	// Value definitions
	rewardScience = @/science
	rewardReputation = @/reputation
	rewardFunds = @/funds

	failureReputation = @/reputation / 4
	failureFunds = @/funds / 8
	advanceFunds = @/funds / 4

	// Behaviour such as vessel location, name etc

	// Satellite
	BEHAVIOUR
	{
		name = SpawnSatellite
		type = SpawnVessel
		deferVesselCreation = true

		VESSEL
		{
			name = @/targetVessel
			craftURL = "ContractPacks/KUM/Assets/Ships/" + @/satelliteList.Random()
			flagURL = Squad/Flags/satellite
			vesselType = Unknown
			owned = false
			targetBody = @/orbitBody

			ORBIT
			{
				SMA = Random(686750.0, 1373500.0)
				ECC = 0.0
				INC = Random(-90.0, 90.0)
				LPE = 4.0
				LAN = 140.0
				MNA = 0.0
				EPH = 1787.3
				REF = 1
			}
		}
	}

	// Parameters for completing the contract
	PARAMETER
	{
		name = IdentificationSequence
		type = All

		title = "Examine the satellite"
		completedMessage = "The satellite was examined, we will confirm its origins... Destroy it!"

		rewardReputation = 4 * Random(0.8, 1.2)

		disableOnStateChange = true
		optional = true

		PARAMETER
		{
			name = RendezvousCraft
			type = Rendezvous

			title = "Approach the satellite within 25 meters of distance"
			notes = "Rendezvous should allow us to examine the satellite with a special device."

			vessel = @/targetVessel

			disableOnStateChange = true

			distance = 25.0
		}

		PARAMETER
		{
			name = IdentifyCraft
			type = Duration

			preWaitText = "Rendezvous for examination"
			waitingText = "Examining satellite..."
			completionText = "Examination"

			duration = 30s

			startCriteria = PARAMETER_COMPLETION
			parameter = RendezvousCraft
		}
	}

	// Combat parameters
	PARAMETER
	{
		name = CombatSequence
		type = Sequence

		title = "Destroy the satellite"

		hiddenParameter = DestroyCraft

		PARAMETER
		{
			name = DestroyCraft
			type = TargetDestroyed

			title = "Destroy the hostile satellite"

			vessel = @/targetVessel
		}

		// Parameter for recovering the vessel after the mission
		PARAMETER
		{
			name = ToBase
			type = All

			title = "Land the vessel and recover it safely on Kerbin"

			optional = @/needRecoverBool
			hidden = @/needRecoverBool
			hideChildren = @/needRecoverBool

			disableOnStateChange = true
			completeInSequence = true

			PARAMETER
			{
				name = LandBase
				type = ReturnHome

				title = "Stop the vessel on the surface"
			}

			PARAMETER
			{
				name = RecoverBase
				type = RecoverVessel

				title = "Recover the vessel"
				completedMessage = "The vessel was successfully recovered!"
			}
		}
	}
}
